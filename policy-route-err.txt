{"level":"warn","message":"Request validation failed [9a65a412-2766-4000-ab42-9bd352e50925]:","metadata":{"errors":{"policyId":"Policy ID must be a valid UUID"}},"timestamp":"2026-02-23T13:29:04.243Z"}
{"level":"warn","message":"Client error processing request: Input validation failed","metadata":{"correlationId":"9a65a412-2766-4000-ab42-9bd352e50925","details":{"policyId":"Policy ID must be a valid UUID"},"errorMessage":"Input validation failed","errorName":"ValidationError","isOperational":true,"method":"GET","path":"/api/admin/policies/not-a-uuid","requestId":"9a65a412-2766-4000-ab42-9bd352e50925","stack":"ValidationError: Input validation failed\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:48:41\n    at Generator.throw (<anonymous>)\n    at rejected (E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:6:65)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"userId":"anonymous"},"timestamp":"2026-02-23T13:29:04.245Z"}
{"level":"error","message":"[PolicyAdminCtrl] Failed to get policy a1b2c3d4-e5f6-7890-1234-567890abcdef","metadata":{"error":{"adminUserId":"test-admin-id-123","error":{}}},"timestamp":"2026-02-23T13:29:04.257Z"}
{"level":"error","message":"Unexpected error during validation middleware [ffcb8b66-5de7-4ed3-aa7d-01f3ac280eec]:","metadata":{"error":{"message":"Cannot set property query of [object Object] which has only a getter","name":"TypeError","stack":"TypeError: Cannot set property query of [object Object] which has only a getter\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:29:26\n    at Generator.next (<anonymous>)\n    at fulfilled (E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:5:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"}},"timestamp":"2026-02-23T13:29:04.298Z"}
{"level":"error","message":"Unexpected error during validation middleware [485b01b3-0409-4751-87a4-6e0cbd238759]:","metadata":{"error":{"message":"Cannot set property query of [object Object] which has only a getter","name":"TypeError","stack":"TypeError: Cannot set property query of [object Object] which has only a getter\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:29:26\n    at Generator.next (<anonymous>)\n    at fulfilled (E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:5:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"}},"timestamp":"2026-02-23T13:29:04.316Z"}
{"level":"error","message":"Unexpected error during validation middleware [c475f858-8960-42f0-9464-78dda07d7979]:","metadata":{"error":{"message":"Cannot set property query of [object Object] which has only a getter","name":"TypeError","stack":"TypeError: Cannot set property query of [object Object] which has only a getter\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:29:26\n    at Generator.next (<anonymous>)\n    at fulfilled (E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:5:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"}},"timestamp":"2026-02-23T13:29:04.334Z"}
{"level":"warn","message":"Request validation failed [ff83b1c6-5d3e-43e2-ad22-a7e843ab5d9a]:","metadata":{"errors":{"policyId":"Policy ID must be a valid UUID"}},"timestamp":"2026-02-23T13:29:04.397Z"}
{"level":"warn","message":"Client error processing request: Input validation failed","metadata":{"correlationId":"ff83b1c6-5d3e-43e2-ad22-a7e843ab5d9a","details":{"policyId":"Policy ID must be a valid UUID"},"errorMessage":"Input validation failed","errorName":"ValidationError","isOperational":true,"method":"PUT","path":"/api/admin/policies/invalid-uuid","requestId":"ff83b1c6-5d3e-43e2-ad22-a7e843ab5d9a","stack":"ValidationError: Input validation failed\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:48:41\n    at Generator.throw (<anonymous>)\n    at rejected (E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:6:65)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"userId":"anonymous"},"timestamp":"2026-02-23T13:29:04.398Z"}
{"level":"warn","message":"Request validation failed [5d59a62c-8ee6-4dec-8705-391a41c5dff5]:","metadata":{"errors":{"":"At least one field must be provided for update."}},"timestamp":"2026-02-23T13:29:04.408Z"}
{"level":"warn","message":"Client error processing request: Input validation failed","metadata":{"correlationId":"5d59a62c-8ee6-4dec-8705-391a41c5dff5","details":{"":"At least one field must be provided for update."},"errorMessage":"Input validation failed","errorName":"ValidationError","isOperational":true,"method":"PUT","path":"/api/admin/policies/a1b2c3d4-e5f6-7890-1234-567890abcdef","requestId":"5d59a62c-8ee6-4dec-8705-391a41c5dff5","stack":"ValidationError: Input validation failed\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:48:41\n    at Generator.throw (<anonymous>)\n    at rejected (E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:6:65)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"userId":"anonymous"},"timestamp":"2026-02-23T13:29:04.408Z"}
{"level":"error","message":"[PolicyAdminCtrl] Failed to update policy a1b2c3d4-e5f6-7890-1234-567890abcdef","metadata":{"error":{"adminUserId":"test-admin-id-123","error":{}}},"timestamp":"2026-02-23T13:29:04.421Z"}
{"level":"error","message":"Server error processing request: Update policy internal failure","metadata":{"error":{"correlationId":"36b84cb9-46c7-401b-80be-83a81448a547","errorMessage":"Update policy internal failure","errorName":"Error","isOperational":false,"method":"PUT","path":"/api/admin/policies/a1b2c3d4-e5f6-7890-1234-567890abcdef","requestId":"36b84cb9-46c7-401b-80be-83a81448a547","stack":"Error: Update policy internal failure\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:286:35\n    at Generator.next (<anonymous>)\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:8:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:4:12)\n    at Object.<anonymous> (E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:285:75)\n    at Promise.then.completed (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-runner@29.7.0\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-runner@29.7.0\\node_modules\\jest-runner\\build\\runTest.js:444:34)","statusCode":500,"userId":"anonymous"}},"timestamp":"2026-02-23T13:29:04.421Z"}
{"level":"warn","message":"Request validation failed [7cb6b3b4-ec49-4afd-8d38-9cbd1d1d534c]:","metadata":{"errors":{"policyId":"Policy ID must be a valid UUID"}},"timestamp":"2026-02-23T13:29:04.475Z"}
{"level":"warn","message":"Client error processing request: Input validation failed","metadata":{"correlationId":"7cb6b3b4-ec49-4afd-8d38-9cbd1d1d534c","details":{"policyId":"Policy ID must be a valid UUID"},"errorMessage":"Input validation failed","errorName":"ValidationError","isOperational":true,"method":"DELETE","path":"/api/admin/policies/invalid-uuid","requestId":"7cb6b3b4-ec49-4afd-8d38-9cbd1d1d534c","stack":"ValidationError: Input validation failed\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:48:41\n    at Generator.throw (<anonymous>)\n    at rejected (E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:6:65)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"userId":"anonymous"},"timestamp":"2026-02-23T13:29:04.475Z"}
{"level":"error","message":"[PolicyAdminCtrl] Failed to delete policy b1c2d3e4-f5a6-7890-1234-567890abcdef","metadata":{"error":{"adminUserId":"test-admin-id-123","error":{}}},"timestamp":"2026-02-23T13:29:04.491Z"}
{"level":"error","message":"Server error processing request: Delete policy internal failure","metadata":{"error":{"correlationId":"85d9a676-00e5-49ad-ac56-bd24c2969881","errorMessage":"Delete policy internal failure","errorName":"Error","isOperational":false,"method":"DELETE","path":"/api/admin/policies/b1c2d3e4-f5a6-7890-1234-567890abcdef","requestId":"85d9a676-00e5-49ad-ac56-bd24c2969881","stack":"Error: Delete policy internal failure\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:337:34\n    at Generator.next (<anonymous>)\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:8:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:4:12)\n    at Object.<anonymous> (E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:336:74)\n    at Promise.then.completed (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-runner@29.7.0\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-runner@29.7.0\\node_modules\\jest-runner\\build\\runTest.js:444:34)","statusCode":500,"userId":"anonymous"}},"timestamp":"2026-02-23T13:29:04.492Z"}
{"level":"error","message":"[PolicyAdminCtrl] Failed to get policy version c1d2e3f4-a5b6-7890-1234-567890abcdef@1","metadata":{"error":{"adminUserId":"test-admin-id-123","error":{"isOperational":true,"name":"PolicyNotFoundError","statusCode":404}}},"timestamp":"2026-02-23T13:29:04.540Z"}
{"level":"warn","message":"Request validation failed [1771bf96-c447-4916-9d52-14596083a894]:","metadata":{"errors":{"policyId":"Policy ID must be a valid UUID"}},"timestamp":"2026-02-23T13:29:04.555Z"}
{"level":"warn","message":"Client error processing request: Input validation failed","metadata":{"correlationId":"1771bf96-c447-4916-9d52-14596083a894","details":{"policyId":"Policy ID must be a valid UUID"},"errorMessage":"Input validation failed","errorName":"ValidationError","isOperational":true,"method":"GET","path":"/api/admin/policies/invalid-uuid/versions/1","requestId":"1771bf96-c447-4916-9d52-14596083a894","stack":"ValidationError: Input validation failed\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:48:41\n    at Generator.throw (<anonymous>)\n    at rejected (E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:6:65)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"userId":"anonymous"},"timestamp":"2026-02-23T13:29:04.556Z"}
{"level":"warn","message":"Request validation failed [ec2106e7-c2e2-418a-841d-0bbd021774da]:","metadata":{"errors":{"version":"Expected number, received nan"}},"timestamp":"2026-02-23T13:29:04.568Z"}
{"level":"warn","message":"Client error processing request: Input validation failed","metadata":{"correlationId":"ec2106e7-c2e2-418a-841d-0bbd021774da","details":{"version":"Expected number, received nan"},"errorMessage":"Input validation failed","errorName":"ValidationError","isOperational":true,"method":"GET","path":"/api/admin/policies/c1d2e3f4-a5b6-7890-1234-567890abcdef/versions/invalid-version","requestId":"ec2106e7-c2e2-418a-841d-0bbd021774da","stack":"ValidationError: Input validation failed\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:48:41\n    at Generator.throw (<anonymous>)\n    at rejected (E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:6:65)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"userId":"anonymous"},"timestamp":"2026-02-23T13:29:04.569Z"}
{"level":"error","message":"[PolicyAdminCtrl] Failed to get policy version c1d2e3f4-a5b6-7890-1234-567890abcdef@1","metadata":{"error":{"adminUserId":"test-admin-id-123","error":{}}},"timestamp":"2026-02-23T13:29:04.581Z"}
{"level":"error","message":"Server error processing request: Failed to get policy version","metadata":{"error":{"correlationId":"62903d4b-9680-4d05-82cd-f6348f4ca180","errorMessage":"Failed to get policy version","errorName":"Error","isOperational":false,"method":"GET","path":"/api/admin/policies/c1d2e3f4-a5b6-7890-1234-567890abcdef/versions/1","requestId":"62903d4b-9680-4d05-82cd-f6348f4ca180","stack":"Error: Failed to get policy version\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:398:34\n    at Generator.next (<anonymous>)\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:8:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:4:12)\n    at Object.<anonymous> (E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:397:96)\n    at Promise.then.completed (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-runner@29.7.0\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-runner@29.7.0\\node_modules\\jest-runner\\build\\runTest.js:444:34)","statusCode":500,"userId":"anonymous"}},"timestamp":"2026-02-23T13:29:04.582Z"}
{"level":"error","message":"[PolicyAdminCtrl] Failed to list policy versions for d1e2f3a4-b5c6-7890-1234-567890abcdef","metadata":{"error":{"adminUserId":"test-admin-id-123","error":{"isOperational":true,"name":"PolicyNotFoundError","statusCode":404}}},"timestamp":"2026-02-23T13:29:04.622Z"}
{"level":"warn","message":"Request validation failed [f4deb7b6-7865-48b8-acbf-7df469db88b0]:","metadata":{"errors":{"policyId":"Policy ID must be a valid UUID"}},"timestamp":"2026-02-23T13:29:04.636Z"}
{"level":"warn","message":"Client error processing request: Input validation failed","metadata":{"correlationId":"f4deb7b6-7865-48b8-acbf-7df469db88b0","details":{"policyId":"Policy ID must be a valid UUID"},"errorMessage":"Input validation failed","errorName":"ValidationError","isOperational":true,"method":"GET","path":"/api/admin/policies/invalid-uuid/versions","requestId":"f4deb7b6-7865-48b8-acbf-7df469db88b0","stack":"ValidationError: Input validation failed\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:48:41\n    at Generator.throw (<anonymous>)\n    at rejected (E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:6:65)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"userId":"anonymous"},"timestamp":"2026-02-23T13:29:04.636Z"}
{"level":"error","message":"[PolicyAdminCtrl] Failed to list policy versions for d1e2f3a4-b5c6-7890-1234-567890abcdef","metadata":{"error":{"adminUserId":"test-admin-id-123","error":{}}},"timestamp":"2026-02-23T13:29:04.648Z"}
{"level":"error","message":"Server error processing request: Failed to list policy versions","metadata":{"error":{"correlationId":"50b6070a-7ec6-4bcf-8885-85138c6b40f4","errorMessage":"Failed to list policy versions","errorName":"Error","isOperational":false,"method":"GET","path":"/api/admin/policies/d1e2f3a4-b5c6-7890-1234-567890abcdef/versions","requestId":"50b6070a-7ec6-4bcf-8885-85138c6b40f4","stack":"Error: Failed to list policy versions\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:456:34\n    at Generator.next (<anonymous>)\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:8:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:4:12)\n    at Object.<anonymous> (E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:455:96)\n    at Promise.then.completed (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-runner@29.7.0\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-runner@29.7.0\\node_modules\\jest-runner\\build\\runTest.js:444:34)","statusCode":500,"userId":"anonymous"}},"timestamp":"2026-02-23T13:29:04.649Z"}
{"level":"error","message":"[PolicyAdminCtrl] Failed to rollback policy e1f2a3b4-c5d6-7890-1234-567890abcdef to version 1","metadata":{"error":{"adminUserId":"test-admin-id-123","error":{"isOperational":true,"name":"PolicyNotFoundError","statusCode":404}}},"timestamp":"2026-02-23T13:29:04.692Z"}
{"level":"warn","message":"Request validation failed [05934119-7574-4db1-97c7-f8b525f8d706]:","metadata":{"errors":{"policyId":"Policy ID must be a valid UUID"}},"timestamp":"2026-02-23T13:29:04.706Z"}
{"level":"warn","message":"Client error processing request: Input validation failed","metadata":{"correlationId":"05934119-7574-4db1-97c7-f8b525f8d706","details":{"policyId":"Policy ID must be a valid UUID"},"errorMessage":"Input validation failed","errorName":"ValidationError","isOperational":true,"method":"POST","path":"/api/admin/policies/invalid-uuid/rollback/1","requestId":"05934119-7574-4db1-97c7-f8b525f8d706","stack":"ValidationError: Input validation failed\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:48:41\n    at Generator.throw (<anonymous>)\n    at rejected (E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:6:65)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"userId":"anonymous"},"timestamp":"2026-02-23T13:29:04.707Z"}
{"level":"warn","message":"Request validation failed [badfce9b-8a94-48e1-90ba-d1dd3d875dbc]:","metadata":{"errors":{"version":"Expected number, received nan"}},"timestamp":"2026-02-23T13:29:04.719Z"}
{"level":"warn","message":"Client error processing request: Input validation failed","metadata":{"correlationId":"badfce9b-8a94-48e1-90ba-d1dd3d875dbc","details":{"version":"Expected number, received nan"},"errorMessage":"Input validation failed","errorName":"ValidationError","isOperational":true,"method":"POST","path":"/api/admin/policies/e1f2a3b4-c5d6-7890-1234-567890abcdef/rollback/invalid-version","requestId":"badfce9b-8a94-48e1-90ba-d1dd3d875dbc","stack":"ValidationError: Input validation failed\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:48:41\n    at Generator.throw (<anonymous>)\n    at rejected (E:\\NodeJS\\PBAC_Auth\\user-management-service\\src\\api\\middlewares\\validation.middleware.ts:6:65)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"userId":"anonymous"},"timestamp":"2026-02-23T13:29:04.720Z"}
{"level":"error","message":"[PolicyAdminCtrl] Failed to rollback policy e1f2a3b4-c5d6-7890-1234-567890abcdef to version 1","metadata":{"error":{"adminUserId":"test-admin-id-123","error":{}}},"timestamp":"2026-02-23T13:29:04.731Z"}
{"level":"error","message":"Server error processing request: Failed to rollback policy","metadata":{"error":{"correlationId":"01e2f99b-be1e-4aa9-8471-1af20f7cac99","errorMessage":"Failed to rollback policy","errorName":"Error","isOperational":false,"method":"POST","path":"/api/admin/policies/e1f2a3b4-c5d6-7890-1234-567890abcdef/rollback/1","requestId":"01e2f99b-be1e-4aa9-8471-1af20f7cac99","stack":"Error: Failed to rollback policy\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:519:34\n    at Generator.next (<anonymous>)\n    at E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:8:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:4:12)\n    at Object.<anonymous> (E:\\NodeJS\\PBAC_Auth\\user-management-service\\tests\\integration\\routes\\policy.admin.routes.integration.spec.ts:518:96)\n    at Promise.then.completed (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-circus@29.7.0\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-runner@29.7.0\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (E:\\NodeJS\\PBAC_Auth\\user-management-service\\node_modules\\.pnpm\\jest-runner@29.7.0\\node_modules\\jest-runner\\build\\runTest.js:444:34)","statusCode":500,"userId":"anonymous"}},"timestamp":"2026-02-23T13:29:04.732Z"}
FAIL tests/integration/routes/policy.admin.routes.integration.spec.ts (5.968 s)
Integration Tests: Policy Admin Routes (/api/admin/policies)
ΓêÜ should return 500 if the service fails unexpectedly (14 ms)
├ù should pass pagination and filter parameters to the service (17 ms)
├ù should return 500 if the service fails unexpectedly (19 ms)
ΓêÜ should return 500 if service fails unexpectedly (12 ms)
ΓêÜ should return 500 if service fails unexpectedly (20 ms)
ΓêÜ should return 500 Internal Server Error if service fails unexpectedly (14 ms)
ΓêÜ should return 500 Internal Server Error if service fails unexpectedly (13 ms)
ΓêÜ should return 500 Internal Server Error if service fails unexpectedly (13 ms)
ΓùÅ Integration Tests: Policy Admin Routes (/api/admin/policies) ΓÇ║ GET /api/admin/policies ΓÇ║ should return 200 OK with a list of policies
expected 200 "OK", got 500 "Internal Server Error"
at tests/integration/routes/policy.admin.routes.integration.spec.ts:198:19
at tests/integration/routes/policy.admin.routes.integration.spec.ts:8:71
ΓùÅ Integration Tests: Policy Admin Routes (/api/admin/policies) ΓÇ║ GET /api/admin/policies ΓÇ║ should pass pagination and filter parameters to the service
expected 200 "OK", got 500 "Internal Server Error"
at tests/integration/routes/policy.admin.routes.integration.spec.ts:209:19
at tests/integration/routes/policy.admin.routes.integration.spec.ts:8:71
ΓùÅ Integration Tests: Policy Admin Routes (/api/admin/policies) ΓÇ║ GET /api/admin/policies ΓÇ║ should return 500 if the service fails unexpectedly
expect(jest.fn()).toHaveBeenCalledTimes(expected)
Expected number of calls: 1
at tests/integration/routes/policy.admin.routes.integration.spec.ts:221:58
ΓùÅ Integration Tests: Policy Admin Routes (/api/admin/policies) ΓÇ║ PUT /api/admin/policies/:policyId ΓÇ║ should return 200 OK with updated policy data if service succeeds
expect(jest.fn()).toHaveBeenCalledWith(...expected)
- Expected
at tests/integration/routes/policy.admin.routes.integration.spec.ts:252:57
Test Suites: 1 failed, 1 total
Tests:       4 failed, 35 passed, 39 total
