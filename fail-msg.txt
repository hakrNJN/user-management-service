[1m[31m  [1mâ— [22m[1mIntegration Tests: User Admin Routes (/api/admin/users) â€º Authentication Guard â€º should allow access with the correct test bypass token[39m[22m

    expected 200 "OK", got 500 "Internal Server Error"
[2m[22m
[2m    [0m [90m 234 |[39m                 [33m.[39m[36mget[39m([32m'/api/admin/users'[39m)[22m
[2m     [90m 235 |[39m                 [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [33mTEST_ADMIN_TOKEN[39m)[22m
[2m    [31m[1m>[22m[2m[39m[90m 236 |[39m                 [33m.[39mexpect([33mHttpStatusCode[39m[33m.[39m[33mOK[39m)[33m;[39m [90m// 200[39m[22m
[2m     [90m     |[39m                  [31m[1m^[22m[2m[39m[22m
[2m     [90m 237 |[39m         })[33m;[39m[22m
[2m     [90m 238 |[39m     })[33m;[39m[22m
[2m     [90m 239 |[39m     [90m// --- POST Create User ---[39m[0m[22m
[2m[22m
[2m      [2mat [22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:236:18[22m[2m[22m
[2m      [2mat [22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:9:71[22m[2m[22m
[2m      [2mat Object.<anonymous>.__awaiter ([22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:5:12)[22m[2m[22m
[2m      [2mat Object.<anonymous> ([22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:231:81)[22m[2m[22m
[2m      ----[22m
[2m      [2mat Test._assertStatus ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:309:14)[22m[2m[22m
[2m      [2mat [22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:365:13[22m[2m[22m
[2m      [2mat Test._assertFunction ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:342:13)[22m[2m[22m
[2m      [2mat Test.assert ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:195:23)[22m[2m[22m
[2m      [2mat localAssert ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:138:14)[22m[2m[22m
[2m      [2mat Server.<anonymous> ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:152:11)[22m[2m[22m

[1m[31m  [1mâ— [22m[1mIntegration Tests: User Admin Routes (/api/admin/users) â€º POST /api/admin/users â€º should return 400 Bad Request if validation fails[39m[22m

    expected 400 "Bad Request", got 201 "Created"
[2m[22m
[2m    [0m [90m 275 |[39m                 [33m.[39m[36mset[39m([33mMOCK_AUTH_HEADER[39m)[22m
[2m     [90m 276 |[39m                 [33m.[39msend(invalidPayload)[22m
[2m    [31m[1m>[22m[2m[39m[90m 277 |[39m                 [33m.[39mexpect([33mHttpStatusCode[39m[33m.[39m[33mBAD_REQUEST[39m)[33m;[39m [90m// 400[39m[22m
[2m     [90m     |[39m                  [31m[1m^[22m[2m[39m[22m
[2m     [90m 278 |[39m             expect(mockUserAdminService[33m.[39mcreateUser)[33m.[39mnot[33m.[39mtoHaveBeenCalled()[33m;[39m[22m
[2m     [90m 279 |[39m         })[33m;[39m[22m
[2m     [90m 280 |[39m[0m[22m
[2m[22m
[2m      [2mat [22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:277:18[22m[2m[22m
[2m      [2mat [22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:9:71[22m[2m[22m
[2m      [2mat Object.<anonymous>.__awaiter ([22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:5:12)[22m[2m[22m
[2m      [2mat Object.<anonymous> ([22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:271:76)[22m[2m[22m
[2m      ----[22m
[2m      [2mat Test._assertStatus ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:309:14)[22m[2m[22m
[2m      [2mat [22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:365:13[22m[2m[22m
[2m      [2mat Test._assertFunction ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:342:13)[22m[2m[22m
[2m      [2mat Test.assert ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:195:23)[22m[2m[22m
[2m      [2mat localAssert ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:138:14)[22m[2m[22m
[2m      [2mat Server.<anonymous> ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:152:11)[22m[2m[22m

[1m[31m  [1mâ— [22m[1mIntegration Tests: User Admin Routes (/api/admin/users) â€º GET /api/admin/users â€º should return 200 OK with a list of users[39m[22m

    expected 200 "OK", got 500 "Internal Server Error"
[2m[22m
[2m    [0m [90m 313 |[39m                 [33m.[39m[36mget[39m([32m'/api/admin/users'[39m)[22m
[2m     [90m 314 |[39m                 [33m.[39m[36mset[39m([33mMOCK_AUTH_HEADER[39m)[22m
[2m    [31m[1m>[22m[2m[39m[90m 315 |[39m                 [33m.[39mexpect([33mHttpStatusCode[39m[33m.[39m[33mOK[39m)[33m;[39m [90m// 200[39m[22m
[2m     [90m     |[39m                  [31m[1m^[22m[2m[39m[22m
[2m     [90m 316 |[39m             expect(mockUserAdminService[33m.[39mlistUsers)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m[22m
[2m     [90m 317 |[39m         })[33m;[39m[22m
[2m     [90m 318 |[39m[0m[22m
[2m[22m
[2m      [2mat [22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:315:18[22m[2m[22m
[2m      [2mat [22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:9:71[22m[2m[22m
[2m      [2mat Object.<anonymous>.__awaiter ([22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:5:12)[22m[2m[22m
[2m      [2mat Object.<anonymous> ([22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:306:68)[22m[2m[22m
[2m      ----[22m
[2m      [2mat Test._assertStatus ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:309:14)[22m[2m[22m
[2m      [2mat [22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:365:13[22m[2m[22m
[2m      [2mat Test._assertFunction ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:342:13)[22m[2m[22m
[2m      [2mat Test.assert ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:195:23)[22m[2m[22m
[2m      [2mat localAssert ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:138:14)[22m[2m[22m
[2m      [2mat Server.<anonymous> ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:152:11)[22m[2m[22m

[1m[31m  [1mâ— [22m[1mIntegration Tests: User Admin Routes (/api/admin/users) â€º GET /api/admin/users â€º should pass query parameters to the service[39m[22m

    expected 200 "OK", got 500 "Internal Server Error"
[2m[22m
[2m    [0m [90m 323 |[39m                 [33m.[39mquery({ limit[33m:[39m [35m5[39m[33m,[39m filter[33m:[39m [32m'status="Enabled"'[39m[33m,[39m paginationToken[33m:[39m [32m'prev'[39m })[22m
[2m     [90m 324 |[39m                 [33m.[39m[36mset[39m([33mMOCK_AUTH_HEADER[39m)[22m
[2m    [31m[1m>[22m[2m[39m[90m 325 |[39m                 [33m.[39mexpect([33mHttpStatusCode[39m[33m.[39m[33mOK[39m)[33m;[39m[22m
[2m     [90m     |[39m                  [31m[1m^[22m[2m[39m[22m
[2m     [90m 326 |[39m             expect(mockUserAdminService[33m.[39mlistUsers)[33m.[39mtoHaveBeenCalledWith(expect[33m.[39manything()[33m,[39m { limit[33m:[39m [35m5[39m[33m,[39m filter[33m:[39m [32m'status="Enabled"'[39m[33m,[39m paginationToken[33m:[39m [32m'prev'[39m })[33m;[39m[22m
[2m     [90m 327 |[39m         })[33m;[39m[22m
[2m     [90m 328 |[39m[0m[22m
[2m[22m
[2m      [2mat [22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:325:18[22m[2m[22m
[2m      [2mat [22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:9:71[22m[2m[22m
[2m      [2mat Object.<anonymous>.__awaiter ([22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:5:12)[22m[2m[22m
[2m      [2mat Object.<anonymous> ([22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:319:70)[22m[2m[22m
[2m      ----[22m
[2m      [2mat Test._assertStatus ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:309:14)[22m[2m[22m
[2m      [2mat [22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:365:13[22m[2m[22m
[2m      [2mat Test._assertFunction ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:342:13)[22m[2m[22m
[2m      [2mat Test.assert ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:195:23)[22m[2m[22m
[2m      [2mat localAssert ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:138:14)[22m[2m[22m
[2m      [2mat Server.<anonymous> ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:152:11)[22m[2m[22m

[1m[31m  [1mâ— [22m[1mIntegration Tests: User Admin Routes (/api/admin/users) â€º GET /api/admin/users â€º should return 500 if the service fails unexpectedly[39m[22m

    [2mexpect([22m[31mjest.fn()[39m[2m).[22mtoHaveBeenCalledTimes[2m([22m[32mexpected[39m[2m)[22m

    Expected number of calls: [32m1[39m
    Received number of calls: [31m0[39m
[2m[22m
[2m    [0m [90m 334 |[39m                 [33m.[39m[36mset[39m([33mMOCK_AUTH_HEADER[39m)[22m
[2m     [90m 335 |[39m                 [33m.[39mexpect([33mHttpStatusCode[39m[33m.[39m[33mINTERNAL_SERVER_ERROR[39m)[33m;[39m [90m// 500[39m[22m
[2m    [31m[1m>[22m[2m[39m[90m 336 |[39m             expect(mockUserAdminService[33m.[39mlistUsers)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m[22m
[2m     [90m     |[39m                                                    [31m[1m^[22m[2m[39m[22m
[2m     [90m 337 |[39m         })[33m;[39m[22m
[2m     [90m 338 |[39m     })[33m;[39m[22m
[2m     [90m 339 |[39m[0m[22m
[2m[22m
[2m      [2mat [22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:336:52[22m[2m[22m
[2m      [2mat fulfilled ([22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:6:58)[22m[2m[22m

[1m[31m  [1mâ— [22m[1mIntegration Tests: User Admin Routes (/api/admin/users) â€º User Group Management â€º DELETE /api/admin/users/:username/groups/:groupName â€º should return 204 No Content when removing user from group[39m[22m

    expected 204 "No Content", got 500 "Internal Server Error"
[2m[22m
[2m    [0m [90m 658 |[39m                     [33m.[39m[36mdelete[39m([32m`/api/admin/users/${targetUsername}/groups/${testGroupName}`[39m)[22m
[2m     [90m 659 |[39m                     [33m.[39m[36mset[39m([33mMOCK_AUTH_HEADER[39m)[22m
[2m    [31m[1m>[22m[2m[39m[90m 660 |[39m                     [33m.[39mexpect([33mHttpStatusCode[39m[33m.[39m[33mNO_CONTENT[39m)[33m;[39m [90m// 204[39m[22m
[2m     [90m     |[39m                      [31m[1m^[22m[2m[39m[22m
[2m     [90m 661 |[39m                 expect(mockUserAdminService[33m.[39mremoveUserFromGroup)[33m.[39mtoHaveBeenCalledWith(expect[33m.[39manything()[33m,[39m targetUsername[33m,[39m testGroupName)[33m;[39m[22m
[2m     [90m 662 |[39m             })[33m;[39m[22m
[2m     [90m 663 |[39m[0m[22m
[2m[22m
[2m      [2mat [22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:660:22[22m[2m[22m
[2m      [2mat [22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:9:71[22m[2m[22m
[2m      [2mat Object.<anonymous>.__awaiter ([22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:5:12)[22m[2m[22m
[2m      [2mat Object.<anonymous> ([22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:655:89)[22m[2m[22m
[2m      ----[22m
[2m      [2mat Test._assertStatus ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:309:14)[22m[2m[22m
[2m      [2mat [22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:365:13[22m[2m[22m
[2m      [2mat Test._assertFunction ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:342:13)[22m[2m[22m
[2m      [2mat Test.assert ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:195:23)[22m[2m[22m
[2m      [2mat localAssert ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:138:14)[22m[2m[22m
[2m      [2mat Server.<anonymous> ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:152:11)[22m[2m[22m

[1m[31m  [1mâ— [22m[1mIntegration Tests: User Admin Routes (/api/admin/users) â€º User Group Management â€º DELETE /api/admin/users/:username/groups/:groupName â€º should return 404 if user/group not found (via service error)[39m[22m

    expected 404 "Not Found", got 500 "Internal Server Error"
[2m[22m
[2m    [0m [90m 668 |[39m                     [33m.[39m[36mdelete[39m([32m`/api/admin/users/${targetUsername}/groups/${testGroupName}`[39m)[22m
[2m     [90m 669 |[39m                     [33m.[39m[36mset[39m([33mMOCK_AUTH_HEADER[39m)[22m
[2m    [31m[1m>[22m[2m[39m[90m 670 |[39m                     [33m.[39mexpect([33mHttpStatusCode[39m[33m.[39m[33mNOT_FOUND[39m)[33m;[39m [90m// 404[39m[22m
[2m     [90m     |[39m                      [31m[1m^[22m[2m[39m[22m
[2m     [90m 671 |[39m                 expect(mockUserAdminService[33m.[39mremoveUserFromGroup)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m[22m
[2m     [90m 672 |[39m[22m
[2m     [90m 673 |[39m[0m[22m
[2m[22m
[2m      [2mat [22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:670:22[22m[2m[22m
[2m      [2mat [22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:9:71[22m[2m[22m
[2m      [2mat Object.<anonymous>.__awaiter ([22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:5:12)[22m[2m[22m
[2m      [2mat Object.<anonymous> ([22m[2m[0m[36mtests/integration/routes/user.admin.routes.integration.spec.ts[39m[0m[2m:664:92)[22m[2m[22m
[2m      ----[22m
[2m      [2mat Test._assertStatus ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:309:14)[22m[2m[22m
[2m      [2mat [22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:365:13[22m[2m[22m
[2m      [2mat Test._assertFunction ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:342:13)[22m[2m[22m
[2m      [2mat Test.assert ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:195:23)[22m[2m[22m
[2m      [2mat localAssert ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:138:14)[22m[2m[22m
[2m      [2mat Server.<anonymous> ([22m[2mnode_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js[2m:152:11)[22m[2m[22m
