[dotenv@17.2.1] injecting env (11) from .env.test -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }
Table TestUsers created successfully. Waiting for it to become active...
Table TestPolicies created successfully. Waiting for it to become active...
Table TestPermissions created successfully. Waiting for it to become active...
Table TestRoles created successfully. Waiting for it to become active...
Table TestAssignments created successfully. Waiting for it to become active...
  console.log
    Validation Middleware - req.body: { name: 'John Doe', age: 30 }

      at src/api/middlewares/validation.middleware.ts:21:21

  console.log
    Validation Middleware - Object.keys(req.body): [ 'name', 'age' ]

      at src/api/middlewares/validation.middleware.ts:22:21

  console.log
    Validation Middleware - JSON.stringify(req.body): {"name":"John Doe","age":30}

      at src/api/middlewares/validation.middleware.ts:23:21

  console.log
    Validation Middleware - req.body: { name: '', age: 17 }

      at src/api/middlewares/validation.middleware.ts:21:21

  console.log
    Validation Middleware - Object.keys(req.body): [ 'name', 'age' ]

      at src/api/middlewares/validation.middleware.ts:22:21

  console.log
    Validation Middleware - JSON.stringify(req.body): {"name":"","age":17}

      at src/api/middlewares/validation.middleware.ts:23:21

  console.log
    Validation Middleware - req.body: { name: 'Jane Doe', age: 25 }

      at src/api/middlewares/validation.middleware.ts:21:21

  console.log
    Validation Middleware - Object.keys(req.body): [ 'name', 'age' ]

      at src/api/middlewares/validation.middleware.ts:22:21

  console.log
    Validation Middleware - JSON.stringify(req.body): {"name":"Jane Doe","age":25}

      at src/api/middlewares/validation.middleware.ts:23:21

  console.log
    Validation Middleware - req.body: { name: 'test' }

      at src/api/middlewares/validation.middleware.ts:21:21

  console.log
    Validation Middleware - Object.keys(req.body): [ 'name' ]

      at src/api/middlewares/validation.middleware.ts:22:21

  console.log
    Validation Middleware - JSON.stringify(req.body): {"name":"test"}

      at src/api/middlewares/validation.middleware.ts:23:21

FAIL tests/unit/api/middlewares/validation.middleware.spec.ts
  validationMiddleware
    ΓêÜ should call next() if validation is successful (50 ms)
    ├ù should call next(ValidationError) and log warning if body validation fails (19 ms)
    ├ù should call next(ValidationError) and log warning if params validation fails (8 ms)
    ΓêÜ should call next(error) and log error for unexpected errors (9 ms)

  ΓùÅ validationMiddleware ΓÇ║ should call next(ValidationError) and log warning if body validation fails

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 2

      Object {
    -   "body.age": "Must be 18 or older",
    -   "body.name": "Name is required",
    +   "age": "Must be 18 or older",
    +   "name": "Name is required",
      }

      64 |         const validationError = next.mock.calls[0][0] as ValidationError;
      65 |         expect(validationError.message).toBe('Input validation failed');
    > 66 |         expect(validationError.details).toEqual({
         |                                         ^
      67 |             'body.name': 'Name is required',
      68 |             'body.age': 'Must be 18 or older',
      69 |         });

      at tests/unit/api/middlewares/validation.middleware.spec.ts:66:41
      at fulfilled (tests/unit/api/middlewares/validation.middleware.spec.ts:5:58)

  ΓùÅ validationMiddleware ΓÇ║ should call next(ValidationError) and log warning if params validation fails

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 1

      Object {
    -   "params.id": "Invalid ID format",
    +   "id": "Invalid ID format",
      }

      93 |         expect(next).toHaveBeenCalledWith(expect.any(ValidationError));
      94 |         const validationError = next.mock.calls[0][0] as ValidationError;
    > 95 |         expect(validationError.details).toEqual({
         |                                         ^
      96 |             'params.id': 'Invalid ID format',
      97 |         });
      98 |         expect(loggerMock.warn).toHaveBeenCalledTimes(1);

      at tests/unit/api/middlewares/validation.middleware.spec.ts:95:41
      at fulfilled (tests/unit/api/middlewares/validation.middleware.spec.ts:5:58)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 2 passed, 4 total
Snapshots:   0 total
Time:        0.976 s, estimated 30 s
Ran all test suites matching /tests\\unit\\api\\middlewares\\validation.middleware.spec.ts/i.
Table TestAssignments not found.
Table TestPermissions not found.
Table TestRoles not found.
Table TestUsers deleted successfully. Waiting for it to be deleted...
Table TestPolicies deleted successfully. Waiting for it to be deleted...
